(window["webpackJsonpsockets-front"]=window["webpackJsonpsockets-front"]||[]).push([[0],{122:function(e,t,n){e.exports=n(219)},128:function(e,t,n){},152:function(e,t){},171:function(e,t,n){},219:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(22),c=n.n(r),s=(n(127),n(128),n(77)),i=n(24),u=n.n(i),l=n(53),m=n(8),h=n(9),d=n(11),p=n(10),f=n(12),g=n(113),k=n.n(g),v=n(54),b=n.n(v),S=n(114),y=n.n(S),j=(n(171),n(221)),E=n(220),O=n(56),w=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).configureItems=function(){return n.props.messages.map(function(e){return o.a.createElement("p",{key:e.id},e.user.username,":",e.text)})},n}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.configureItems();return o.a.createElement(o.a.Fragment,null,e)}}]),t}(o.a.Component),C=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return this.props.rooms.map(function(t){return o.a.createElement(O.a,{className:"room-btn",onClick:function(){return e.props.onClick(t.id)},key:t.id},t.name)})}}]),t}(o.a.Component),I=n(78);function x(e){var t=o.a.useState(""),n=Object(I.a)(t,2),a=n[0],r=n[1],c=o.a.useState(""),s=Object(I.a)(c,2),i=s[0],u=s[1];return o.a.createElement("div",null,o.a.createElement("h2",null,"Username"),o.a.createElement(E.a,{value:a,onChange:function(e){return r(e.currentTarget.value)}}),o.a.createElement("h2",null,"Password"),o.a.createElement(E.a,{type:"password",value:i,onChange:function(e){return u(e.currentTarget.value)}}),o.a.createElement(O.a,{onClick:function(){return e.onClick(a,i)}},"Submit"))}var R=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("h1",null,"Haven't got an account?"),o.a.createElement(O.a,{onClick:function(){return e.props.handleScreen(B.register)}},"Register!"),o.a.createElement(x,{onClick:this.props.onSubmit}))}}]),t}(o.a.Component),A=function(e){function t(){return Object(m.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("h1",null,"Already have an account?"),o.a.createElement(O.a,{onClick:function(){return e.props.handleScreen(B.login)}},"Login!"),o.a.createElement(x,{onClick:this.props.onSubmit}))}}]),t}(o.a.Component),T=j.a.Header,L=j.a.Footer,V=j.a.Sider,z=j.a.Content,J="https://soccets.herokuapp.com",B={default:"default",login:"login",register:"register"},D=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(o)))).state={text:"",messages:[],rooms:[],typings:[],addRoomVal:"",screenType:B.login,roomId:""},n.handleSocket=function(){n.socket=k()(J,{query:{token:localStorage.getItem("token")}}),n.socket.on("connect",function(){console.log("connected")}),n.socket.on("rooms",function(e){n.setState({rooms:e})})},n.handleScreen=function(e){n.setState({screenType:e})},n.handleSubmit=function(e){e.preventDefault(),n.state.text&&(n.socket.emit("message",{text:n.state.text,roomId:n.state.roomId}),n.setState({text:""}))},n.handleChange=function(e){n.setState({text:e.currentTarget.value}),n.socket.emit("room/typing",{id:n.state.roomId})},n.handlePress=function(e){13===e.keyCode&&n.handleSubmit(e)},n.handleLogin=function(){var e=Object(l.a)(u.a.mark(function e(t,a){var o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("".concat(J,"/user/login"),{username:t,password:a});case 2:o=e.sent,localStorage.setItem("token",o.headers.authorization),n.handleScreen(B.default),n.handleSocket();case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.handleRegister=function(){var e=Object(l.a)(u.a.mark(function e(t,a){var o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.post("".concat(J,"/user/register"),{username:t,password:a});case 2:o=e.sent,localStorage.setItem("token",o.headers.authorization),n.handleScreen(B.default),n.handleSocket();case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.handleAddRoomChange=function(e){n.setState({addRoomVal:e.currentTarget.value})},n.handleAddRoom=function(){n.socket.emit("room/new",{name:n.state.addRoomVal}),n.setState({addRoomVal:""})},n.handleRoomJoin=function(e){e!==n.state.roomId&&(n.socket.removeListener("room/".concat(n.state.roomId)),n.socket.removeListener("room/".concat(n.state.roomId,"/joiners")),n.socket.removeListener("room/".concat(n.state.roomId,"/message")),n.socket.removeListener("room/".concat(n.state.roomId,"/typing")),n.setState({roomId:e}),n.socket.on("room/".concat(e),function(e){n.setState({messages:e})}),n.socket.on("room/".concat(e,"/joiners"),function(e){var t=Object(s.a)(n.state.messages);t.push(e),n.setState({messages:t})}),n.socket.on("room/".concat(e,"/message"),function(e){n.setState({messages:e})}),n.socket.on("room/".concat(e,"/typing"),function(t){n.setState({typings:y.a.uniqBy([].concat(Object(s.a)(n.state.typings),[t]),"user.id")}),setTimeout(function(){n.setState({typings:n.state.typings.filter(function(n){return n.roomId!==e&&n.user.id!==t.user.id})})},1e3)}),n.socket.emit("room/join",{id:e}))},n}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")){e.next=2;break}return e.abrupt("return",this.handleScreen(B.login));case 2:return e.next=4,b.a.get("".concat(J,"/user"),{headers:{Authorization:localStorage.getItem("token")}});case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",this.handleScreen(B.login));case 7:localStorage.setItem("token",t.headers.authorization),this.handleScreen(B.default),this.handleSocket();case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.screenType===B.login?o.a.createElement(R,{onSubmit:this.handleLogin,handleScreen:this.handleScreen}):this.state.screenType===B.register?o.a.createElement(A,{onSubmit:this.handleRegister,handleScreen:this.handleScreen}):o.a.createElement(j.a,null,o.a.createElement(T,null,"Header"),o.a.createElement(j.a,null,o.a.createElement(V,{theme:"light"},o.a.createElement(C,{rooms:this.state.rooms,onClick:this.handleRoomJoin}),o.a.createElement(E.a,{value:this.state.addRoomVal,onChange:this.handleAddRoomChange,placeholder:"Room name for add"}),o.a.createElement(O.a,{onClick:this.handleAddRoom},"Add room")),o.a.createElement(j.a,{className:"chat-layout"},o.a.createElement(z,null,o.a.createElement(w,{messages:this.state.messages}),!!this.state.typings.length&&o.a.createElement("span",null,this.state.typings.filter(function(t){return t.roomId===e.state.roomId}).map(function(e){return e.user.username}).join(", ")," is typing")),o.a.createElement(L,null,o.a.createElement(E.a,{value:this.state.text,onKeyDown:this.handlePress,onChange:this.handleChange}),o.a.createElement(O.a,{type:"submit",onClick:this.handleSubmit},"\u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[122,1,2]]]);
//# sourceMappingURL=main.bbe80a68.chunk.js.map